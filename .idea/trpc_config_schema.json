{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "global": {
      "type": "object",
      "description": "全局配置",
      "properties": {
        "namespace": {
          "type": "string",
          "description": "必填，通常使用 Production 或 Development"
        },
        "env_name": {
          "type": "string",
          "description": "选填，环境名称，具体请参考 [多环境](https://iwiki.woa.com/pages/viewpage.action?pageId=99485673) 文档"
        },
        "container_name": {
          "type": "string",
          "description": "选填，容器名"
        },
        "local_ip": {
          "type": "string",
          "description": "选填，当未配置服务端 ip 时，使用该字段作为默认 ip,可使用占位符 ${ip},ip 和 nic 二选一，优先 ip",
          "pattern": "^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^(?:[A-Fa-f0-9]{1,4}:){7}[A-Fa-f0-9]{1,4}$|^\\$\\{ip\\}$|^\\$\\{nic\\}$"
        },
        "enable_set": {
          "type": "string",
          "description": "选填，是否开启 set 功能，用于服务发现，默认为 N（注意，它的类型是 String，不是 Boolean）",
          "enum": [
            "Y",
            "N"
          ]
        },
        "full_set_name": {
          "type": "string",
          "description": "选填，set 分组的名字"
        },
        "read_buffer_size": {
          "type": "number",
          "description": "选填，网络收包缓冲区大小（单位 B)。<=0 表示禁用，不填使用默认值 4096"
        }
      },
      "required": [
        "namespace"
      ]
    },
    "server": {
      "type": "object",
      "description": "服务端相关配置",
      "properties": {
        "app": {
          "type": "string",
          "description": "必填，服务所属的应用名"
        },
        "server": {
          "type": "string",
          "description": "必填，服务所属的服务名"
        },
        "bin_path": {
          "type": "string",
          "description": "选填，可执行文件的路径"
        },
        "data_path": {
          "type": "string",
          "description": "选填，数据文件的路径"
        },
        "conf_path": {
          "type": "string",
          "description": "选填，配置文件的路径"
        },
        "network": {
          "type": "string",
          "description": "选填，网络类型，当 service 未配置 network 时，以该字段为准，默认为 tcp",
          "enum": [
            "tcp",
            "tcp4",
            "tcp6",
            "udp",
            "udp4",
            "udp6"
          ]
        },
        "protocol": {
          "type": "string",
          "description": "选填，协议类型，当 service 未配置 protocol 时，以该字段为准，默认为 trpc"
        },
        "filter": {
          "type": "array",
          "description": "选填，所有 service 共享的拦截器配置，为列表类型",
          "items": {
            "type": "string"
          }
        },
        "service": {
          "type": "array",
          "description": "服务端服务设置",
          "items": {
            "type": "object",
            "properties": {
              "disable_request_timeout": {
                "type": "boolean",
                "description": "选填，是否禁止继承上游的超时时间，用于关闭全链路超时机制，默认为 false"
              },
              "ip": {
                "type": "string",
                "description": "选填，service 监听的 IP 地址，可使用占位符 ${ip},ip 和 nic 二选一，优先 ip,如果为空，则会尝试获取网卡 IP，如果仍为空，则使用 global.local_ip",
                "pattern": "^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^(?:[A-Fa-f0-9]{1,4}:){7}[A-Fa-f0-9]{1,4}$|^\\$\\{ip\\}$|^\\$\\{nic\\}$"
              },
              "name": {
                "type": "string",
                "description": "必填，服务名，用于服务发现"
              },
              "nic": {
                "type": "string",
                "description": "选填，该 service 绑定的网卡，只有 ip 为空时，才会生效"
              },
              "port": {
                "type": "number",
                "description": "选填，该 service 绑定的端口，address 为空时，port 必填"
              },
              "address": {
                "type": "string",
                "description": "选填，service 监听的地址，为空时使用 ip:port，非空时，忽略 ip:port"
              },
              "network": {
                "type": "string",
                "description": "选填，网络类型，为空时，使用 server.network",
                "enum": [
                  "tcp",
                  "tcp4",
                  "tcp6",
                  "udp",
                  "udp4",
                  "udp6"
                ]
              },
              "protocol": {
                "type": "string",
                "description": "选填，协议类型，为空时，使用 server.protocol"
              },
              "timeout": {
                "type": "number",
                "description": "选填，service 处理请求的超时时间 单位 毫秒"
              },
              "idletime": {
                "type": "number",
                "description": "选填，长连接空闲时间，单位 毫秒"
              },
              "registry": {
                "type": "string",
                "description": "选填，使用哪个注册中心 polaris"
              },
              "filter": {
                "type": "array",
                "description": "选填，拦截器列表，优先级低于 server.filter，为列表类型",
                "items": {
                  "type": "string"
                }
              },
              "tls_key": {
                "type": "string",
                "description": "选填，服务端需要提供的 TLS 私钥，当 tls_key 和 tls_cert 都非空时，才会开启 tls 服务"
              },
              "tls_cert": {
                "type": "string",
                "description": "选填，服务端需要提供的 TLS 公钥，当 tls_key 和 tls_cert 都非空时，才会开启 tls 服务"
              },
              "ca_cert": {
                "type": "string",
                "description": "选填，如果开启反向认证，需要提供 client 的 CA 证书"
              },
              "server_async": {
                "type": "string",
                "description": "选填，服务端是否开启异步处理，默认为 true"
              },
              "max_routines": {
                "type": "number",
                "description": "选填，服务在异步处理模式下，最大协程数限制，不设置或者 <=0，使用默认值：1<<31 - 1。异步模式生效，同步模式不生效"
              },
              "writev": {
                "type": "boolean",
                "description": "选填，启用服务器批量发包 (writev 系统调用）, 默认为 false"
              }
            },
            "required": [
              "name"
            ]
          }
        },
        "admin": {
          "type": "object",
          "description": "服务端主机设置",
          "properties": {
            "ip": {
              "type": "string",
              "description": "选填，admin 绑定的 IP，默认为 localhost,可使用占位符 ${ip},ip 和 nic 二选一，优先 ip",
              "pattern": "^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$|^(?:[A-Fa-f0-9]{1,4}:){7}[A-Fa-f0-9]{1,4}$|^\\$\\{ip\\}$|^\\$\\{nic\\}$"
            },
            "nic": {
              "type": "string",
              "description": "选填，网卡名，ip 字段为空时，会尝试从网卡获取 IP"
            },
            "port": {
              "type": "number",
              "description": "选填，admin 绑定的端口，如果为 0，即默认值，admin 功能不会开启"
            },
            "read_timeout": {
              "type": "number",
              "description": "选填，读超时时间，单位为 ms，默认为 3000ms"
            },
            "write_timeout": {
              "type": "number",
              "description": "选填，写超时时间，单位为 ms，默认为 3000ms"
            },
            "enable_tls": {
              "type": "boolean",
              "description": "选填，是否开启 TLS，目前不支持，设置为 true 会直接报错"
            }
          }
        }
      },
      "required": [
        "app",
        "server"
      ]
    },
    "client": {
      "type": "object",
      "description": "客户端设置",
      "properties": {
        "namespace": {
          "type": "string",
          "description": "选填，为空时，使用 global.namespace"
        },
        "network": {
          "type": "string",
          "description": "选填，网络类型，当 service 未配置 network 时，以该字段为准",
          "enum": [
            "tcp",
            "tcp4",
            "tcp6",
            "udp",
            "udp4",
            "udp6"
          ]
        },
        "protocol": {
          "type": "string",
          "description": "选填，协议类型，当 service 未配置 protocol 时，以该字段为准"
        },
        "filter": {
          "type": "array",
          "description": "选填，所有 service 共享的拦截器配置，为列表类型",
          "items": {
            "type": "string"
          }
        },
        "timeout": {
          "type": "number",
          "description": "选填，客户端超时时间，当 service 未配置 timeout，以该字段为准 单位 毫秒"
        },
        "discovery": {
          "type": "string",
          "description": "选填，服务发现策略，当 service 未配置 discovery 时，以该字段为准"
        },
        "loadbalance": {
          "type": "string",
          "description": "选填，负载均衡策略，当 service 未配置 loadbalance 时，以该字段为准"
        },
        "circuitbreaker": {
          "type": "string",
          "description": "选填，熔断策略，当 service 未配置 circuitbreaker 时，以该字段为准"
        },
        "service": {
          "type": "array",
          "description": "必填，被调服务列表",
          "items": {
            "type": "object",
            "properties": {
              "callee": {
                "type": "string",
                "description": "被调服务名，如果使用 pb，callee 必须与 pb 中定义的服务名保持一致，callee 和 name 至少填写一个，为空时，使用 name 字段"
              },
              "name": {
                "type": "string",
                "description": "被调服务名，常用于服务发现，注意区分 [naming service 和 proto service](https://iwiki.woa.com/pages/viewpage.action?pageId=284289117)，name 和 callee 至少填写一个，为空时，使用 callee 字段"
              },
              "env_name": {
                "type": "string",
                "description": "选填，环境名，用于服务路由"
              },
              "set_name": {
                "type": "string",
                "description": "选填，set 名，用于服务路由"
              },
              "disable_servicerouter": {
                "type": "boolean",
                "description": "选填，是否禁用服务路由，默认为 false，服务路由概念可参考这里：https://iwiki.woa.com/pages/viewpage.action?pageId=99485673"
              },
              "namespace": {
                "type": "string",
                "description": "选填，为空时，使用 client.namespace"
              },
              "target": {
                "type": "string",
                "description": "选填，目标服务，非空时，selector 将以 target 中的信息为准"
              },
              "password": {
                "type": "string",
                "description": "选填，被调服务密码"
              },
              "discovery": {
                "type": "string",
                "description": "选填，服务发现策略"
              },
              "loadbalance": {
                "type": "string",
                "description": "选填，负载均衡策略"
              },
              "circuitbreaker": {
                "type": "string",
                "description": "选填，熔断策略"
              },
              "network": {
                "type": "string",
                "description": "选填，网络类型，为空时，使用 client.network",
                "enum": [
                  "tcp",
                  "tcp4",
                  "tcp6",
                  "udp",
                  "udp4",
                  "udp6"
                ]
              },
              "timeout": {
                "type": "number",
                "description": "选填，超时时间，为空时，使用 client.timeout 单位 毫秒"
              },
              "protocol": {
                "type": "string",
                "description": "选填，协议类型，为空时，使用 client.protocol"
              },
              "serialization": {
                "type": "boolean",
                "description": "选填，序列化协议，默认为 -1，即不设置，(0=pb, 1=JCE, 2=json, 3=flat_buffer, 4=bytes_flow)",
                "enum": [
                  0,
                  1,
                  2,
                  3,
                  4
                ]
              },
              "compression": {
                "type": "number",
                "description": "选填，压缩协议，默认为 0，即不压缩，(0=no_compression, 1=gzip, 2=snappy, 3=zlib)",
                "enum": [
                  0,
                  1,
                  2,
                  3
                ]
              },
              "tls_key": {
                "type": "string",
                "description": "选填，client 私钥，必须与 tls_cert 配合使用"
              },
              "tls_cert": {
                "type": "string",
                "description": "选填，client 公钥，必须与 tls_key 配合使用"
              },
              "ca_cert": {
                "type": "string",
                "description": "选填，服务端 CA 证书路径，为 none 时，跳过对服务端的认证"
              },
              "tls_server_name": {
                "type": "string",
                "description": "选填，校验 TLS 时的服务名"
              },
              "filter": {
                "type": "array",
                "description": "选填，拦截器列表，优先级低于 client.filter，为列表类型",
                "items": {
                  "type": "string"
                }
              }
            },
            "required": [
              "name"
            ]
          }
        }
      },
      "required": [
        "service"
      ]
    },
    "plugins": {
      "type": "object"
    }
  }
}
